---
import { Icon } from 'astro-icon';
---

<div id="header">
  <div id="button-wrapper">
    <Icon id="sun" class="notransition" width="30px" name="mdi:white-balance-sunny" />
    <Icon id="moon" class="notransition" width="30px" name="mdi:weather-night" />
    <button id="theme-button"></button>
  </div>
  <a href="/" id="header-text">The Eludris Developer Portal</a>
  <a href="https://github.com/eludris/eludris">
    <Icon name="akar-icons:github-fill" width="30px" />
  </a>
</div>

<script is:inline>
  let theme =
    localStorage.getItem('theme') ??
    (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
      ? 'dark'
      : 'light');

  if (theme == 'dark') {
    document.documentElement.classList.add('dark');
  }

  document.getElementById('theme-button')?.addEventListener('click', () => {
    if (document.documentElement.classList.contains('dark')) {
      document.documentElement.classList.remove('dark');
      theme = 'light';
    } else {
      document.documentElement.classList.add('dark');
      theme = 'dark';
    }
    localStorage.setItem('theme', theme);
  });
</script>

<script>
  const content = document.getElementById('slot');
  const header = document.getElementById('header');
  let lastScroll = 0;

  content!.addEventListener('scroll', () => {
    if (content!.scrollTop > 0) {
      header!.style.borderBottomWidth = '1px';
    } else {
      header!.style.borderBottomWidth = '0px';
    }
    if (window.innerWidth < 1200 && content!.scrollTop > lastScroll) {
      header!.classList.add('header-hidden');
    } else if (window.innerWidth < 1200) {
      header!.classList.remove('header-hidden');
    }
    lastScroll = content!.scrollTop;
  });

  setTimeout(() => {
    document.getElementById('moon')!.classList.remove('notransition');
    document.getElementById('sun')!.classList.remove('notransition');
  }, 0); // why the heck does this work???
</script>

<style>
  #header {
    width: 100%;
    display: flex;
    align-items: center;
    border: 0px solid var(--gray-400);
    background-color: var(--gray-100);
    padding: 5px 20px;
    box-sizing: border-box;
    transition: height ease-in-out 250ms, padding ease-in-out 250ms, opacity ease-in-out 50ms;
  }

  #header.header-hidden {
    height: 0;
    padding: 0;
    opacity: 0;
  }

  #header a {
    border: unset;
    color: inherit;
  }

  #header [astro-icon] {
    color: var(--gray-500);
    transition: color ease-in-out 125ms;
  }

  #header [astro-icon]:hover {
    color: var(--gray-600);
  }

  #header-text {
    font-size: 22px;
    margin: 10px auto;
    font-weight: 300;
  }

  #header-text:hover {
    color: var(--color-text-100);
  }

  #button-wrapper {
    position: relative;
    width: 30px;
    height: 30px;
    transition: color ease-in-out 200ms;
  }

  #button-wrapper:hover > [astro-icon] {
    color: var(--gray-600);
  }

  #theme-button {
    position: absolute;
    border: unset;
    background-color: inherit;
    width: 30px;
    height: 30px;
    padding: 2px;
    cursor: pointer;
  }

  #button-wrapper > [astro-icon] {
    position: absolute;
    transition: transform ease-in-out 250ms, opacity ease-in-out 250ms, color ease-in-out 125ms;
  }

  :where(:root.dark #sun) {
    transform: translate(0, 100%);
    opacity: 0;
    z-index: -1;
  }

  :where(:root:not(.dark) #moon) {
    transform: translate(0, 100%);
    opacity: 0;
    z-index: -1;
  }

  .notransition {
    transition: unset !important;
  }

  @media only screen and (max-width: 1200px) {
  }
</style>
